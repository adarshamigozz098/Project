<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>SHOEzzo</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="" />
  <meta property="og:type" content="" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="" />
  <link rel="shortcut icon" type="image/x-icon" href="imgs/theme/favicon.svg" />
  <link href="css/main.css?v=1.1" rel="stylesheet" type="text/css" />

<body>
  <div class="screen-overlay"></div>
  <aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
      <a class="navbar-brand" href="/">SHOEzzo</a>
      <div>
        <button class="btn btn-icon btn-aside-minimize"><i class="text-muted material-icons md-menu_open"></i></button>
      </div>
    </div>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item">
          <a class="menu-link" href="/admin/dashboard">
            <i class="icon material-icons md-home"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/users">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Users</span>
          </a>
        <li class="menu-item">
          <a class="menu-link" href="/admin/category">
            <i class="icon material-icons md-shopping_cart"></i>
            <span class="text">Catgeory</span>
          </a>

        </li>
        <li class="menu-item active">
          <a class="menu-link" href="/admin/products">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Products</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/order">
            <i class="icon material-icons md-shopping_cart"></i>
            <span class="text">Orders</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/coupon">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Coupons</span>
          </a>
        </li>
      </ul>
      <br />
      <br />
    </nav>
  </aside>
  <main class="main-wrap">
    <header class="main-header navbar">

      <div class="col-search">
        <form id="adminSearchForm" class="search">
          <div class="input-group">
            <input id="adminSearchInput" type="text" class="form-control" placeholder="Search product" />
            <button class="btn btn-light bg" type="submit"><i class="material-icons md-search"></i></button>
          </div>
        </form>
      </div>

      <div class="col-nav">
        <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
            class="material-icons md-apps"></i></button>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link btn-icon" href="#">
              <i class="material-icons md-notifications animation-shake"></i>
              <span class="badge rounded-pill">3</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i> </a>
          </li>
          <li class="nav-item">
            <a href="#" class="requestfullscreen nav-link btn-icon"><i class="material-icons md-cast"></i></a>
          </li>
          <li class="dropdown nav-item">
            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage" aria-expanded="false"><i
                class="material-icons md-public"></i></a>
            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
              <a class="dropdown-item text-brand" href="#"><img src="imgs/theme/flag-us.png" alt="English" />English</a>
          
            </div>
          </li>
          <li class="dropdown nav-item">
            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount" aria-expanded="false">
              <img class="img-xs rounded-circle" src="imgs/people/avatar-2.png" alt="User" /></a>
              <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">

                <div class="dropdown-divider"></div>
                <a class="dropdown-item text-danger" href="/admin/logout">
                  <i class="material-icons md-exit_to_app"></i>Logout
                </a>
              </div>
          </li>
        </ul>
      </div>
      <style>
        img {
          max-width: 35%;
          border-radius: 5px;
        }
      </style>
    </header>

    <section class="content-main">
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="col-lg-3">
          </div>
          <div class="card">
            <div class="card-body">
              <div class="mb-3">
                <!-- Add Products Button with Link -->
                <a href="/admin/products/addProducts" class="btn btn-primary">Add Products</a>
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-contextual" id="example">
              <thead>
                <tr>
                  <th>IMAGE</th>
                  <th>PRODUCT NAME</th>
                  <th>QUANTITY</th>
                  <th>PRICE</th>
                  <th>BRAND</th>
                  <th>STATUS</th>
                  <th>ACTION</th>
                  <th>EDIT</th>
                  <th>DELETE</th>
                </tr>
              </thead>
              <tbody>
                <% if(products.length> 0) { %>
                  <% for(let i=0; i < products.length; i++) { %>
                    <tr>
                      <td >
                   
                        <img src="/images/<%= products[i].image[0] %>" alt="" width="120" height="100">
                      </td>
                      <td>
                        <%= products[i].name %>
                      </td>
                      <td>
                        <%= products[i].quantity %>
                      </td>
                      <td>
                        <%= products[i].price %>
                      </td>
                      <td>
                        <%= products[i].brand %>
                      </td>
                      <td>
                        <span id="status_<%= products[i]._id %>"
                            class="badge rounded-pill alert-warning <%= products[i].is_listed ? 'status-listed' : 'status-unlisted' %>">
                            <%= products[i].is_listed ? 'Listed' : 'Unlisted' %>
                        </span>
                    </td>
                    <td>
                        <button class="btn product-status <%= products[i].is_listed ? 'btn-success' : 'btn-danger' %> listBtn"
                            data-product-id="<%= products[i]._id %>"
                            data-current-status="<%= products[i].is_listed ? 'listed' : 'unlisted' %>">
                            <%= products[i].is_listed ? 'Unlist' : 'List' %>
                        </button>
                    </td>
                    
                      <td>
                        <button class="btn-inverse-primary ">
                          <a href="/admin/editProduct?productsId=<%= products[i]._id %> ">Edit</a>
                        </button>
                      </td>
                      <td>
                        <button class="deleteBtn btn btn-danger btn-sm" onclick="confirmDelete('<%= products[i]._id %>')">Delete</button>
                      </td>                      
                    </tr>
                    <% } %>
                      <% } %>
              </tbody>
            </table>


            <!-- pageination -->
            <div class="pagination-area mt-30 mb-50">
              <nav aria-label="Page navigation example" style="margin-top: 10px;">
                <ul class="pagination justify-content-start">
                  <% if (currentPage > 1) { %>
                    <li class="page-item"><a class="page-link" href="?page=1&search=<%= searchTerm %>">1</a></li>
                  <% } %>
                  <% for (let i = 2; i <= totalPages; i++) { %>
                    <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                      <a class="page-link" href="?page=<%= i %>&search=<%= searchTerm %>"><%= i %></a>
                    </li>
                  <% } %>
                  <% if (currentPage < totalPages) { %>
                    <li class="page-item">
                      <a class="page-link" href="?page=<%= totalPages %>&search=<%= searchTerm %>">
                        <i class="material-icons md-chevron_right"></i>
                      </a>
                    </li>
                  <% } %>
                </ul>
              </nav>
            </div>
            
          </div>
        </div>     
      </div>
    </section>
      

      <style>
        .table thead th {
          padding: 8px;
          margin: 0;
        }
      </style>


      <footer class="main-footer font-xs">
        <div class="row pb-30 pt-15">
          <div class="col-sm-6">
            <script>
              document.write(new Date().getFullYear());
            </script>
          </div>
        </div>
      </footer>
      </head>
  </main>

  <script src="js/vendors/jquery-3.6.0.min.js"></script>
  <script src="js/vendors/bootstrap.bundle.min.js"></script>
  <script src="js/vendors/select2.min.js"></script>
  <script src="js/vendors/perfect-scrollbar.js"></script>
  <script src="js/vendors/jquery.fullscreen.min.js"></script>
  <script src="js/main.js?v=1.1" type="text/javascript"></script>




<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const adminSearchForm = document.getElementById("adminSearchForm");
    const adminSearchInput = document.getElementById("adminSearchInput");

    adminSearchForm.addEventListener("submit", function(event) {
      event.preventDefault(); 
      const searchValue = adminSearchInput.value.trim();
      if (searchValue !== "") { 
        window.location.href = "/admin/products?search=" + encodeURIComponent(searchValue); 
      } else {
        window.location.href = "/admin/products"; 
      }
    });
  });
</script>


<!-- Delete  -->
<script>
  function confirmDelete(productId) {
    Swal.fire({
      title: 'Are you sure?',
      text: 'You are about to delete this product. This action cannot be undone.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = `/admin/deleteProduct?productsId=${productId}`;
      }
    });
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
 document.addEventListener("DOMContentLoaded", function () {
  const listOrUnlistButtons = document.querySelectorAll(".listBtn");

  listOrUnlistButtons.forEach((button) => {
    button.addEventListener("click", async function () {
      const productId = this.dataset.productId;

      try {
        const response = await axios.post(`/admin/products/${productId}/list-or-unlist`);

        const updatedProductData = response.data;

        if (updatedProductData.is_listed) {
          this.textContent = "Unlist";
          this.classList.remove("btn-danger");
          this.classList.add("btn-success");
        } else {
          this.textContent = "List";
          this.classList.remove("btn-success");
          this.classList.add("btn-danger");
        }

        const badge = document.getElementById(`status_${productId}`);
        badge.textContent = updatedProductData.is_listed ? "Listed" : "Unlisted";
        badge.classList.remove(updatedProductData.is_listed ? "status-unlisted" : "status-listed");
        badge.classList.add(updatedProductData.is_listed ? "status-listed" : "status-unlisted");

      } catch (error) {
        console.log(error);
      }
    });
  });
});
</script>


  <style>
    
  </style>

</body>

</html>